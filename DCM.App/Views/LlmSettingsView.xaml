<UserControl x:Class="DCM.App.Views.LlmSettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ap="clr-namespace:DCM.App.Infrastructure.AttachedProperties"
             xmlns:sys="clr-namespace:System;assembly=mscorlib">
  <UserControl.Resources>
    <x:Array x:Key="SuggestionCountOptions"
             Type="{x:Type sys:Int32}">
      <sys:Int32>1</sys:Int32>
      <sys:Int32>2</sys:Int32>
      <sys:Int32>3</sys:Int32>
      <sys:Int32>4</sys:Int32>
      <sys:Int32>5</sys:Int32>
    </x:Array>
  </UserControl.Resources>
  <Grid Margin="0,0,8,0">
    <Grid.RowDefinitions>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <ScrollViewer Grid.Row="0"
                  VerticalScrollBarVisibility="Auto">
      <Grid HorizontalAlignment="Left"
            MaxWidth="{StaticResource SettingsContentMaxWidth}"
            VerticalAlignment="Top">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"
                            MinWidth="{StaticResource SettingsColumnMinWidth}"/>
          <ColumnDefinition Width="{StaticResource SpacingL}"/>
          <ColumnDefinition Width="*"
                            MinWidth="{StaticResource SettingsColumnMinWidth}"/>
        </Grid.ColumnDefinitions>

        <Grid Grid.Column="0">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="{StaticResource SpacingM}"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <GroupBox Grid.Row="0"
                    Style="{StaticResource SettingsSectionGroupBox}"
                    Header="{DynamicResource Settings.LLM.Mode}">
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- 0: Mode ComboBox -->
                <RowDefinition Height="Auto"/> <!-- 1: Preset Label -->
                <RowDefinition Height="Auto"/> <!-- 2: Preset ComboBox + Download -->
                <RowDefinition Height="Auto"/> <!-- 3: Download Progress -->
                <RowDefinition Height="Auto"/> <!-- 4: Custom Path Label -->
                <RowDefinition Height="Auto"/> <!-- 5: Custom Path TextBox -->
                <RowDefinition Height="Auto"/> <!-- 6: Model Type Label -->
                <RowDefinition Height="Auto"/> <!-- 7: Model Type ComboBox -->
                <RowDefinition Height="Auto"/> <!-- 8: System Prompt Label -->
                <RowDefinition Height="Auto"/> <!-- 9: System Prompt TextBox -->
                <RowDefinition Height="Auto"/> <!-- 10: Status -->
              </Grid.RowDefinitions>
              <ComboBox Grid.Row="0"
                        x:Name="LlmModeComboBox"
                        MinWidth="200"
                        SelectionChanged="LlmModeComboBox_SelectionChanged">
                <ComboBoxItem Content="{DynamicResource Settings.LLM.Off}"
                              Tag="Off"/>
                <ComboBoxItem Content="{DynamicResource Settings.LLM.Local}"
                              Tag="Local"/>
              </ComboBox>

              <!-- Model Preset Selection -->
              <TextBlock Grid.Row="1"
                         Text="{DynamicResource Settings.LLM.ModelPreset}"
                         FontSize="{StaticResource FontSizeS}"
                         Foreground="{StaticResource TextMutedBrush}"
                         Margin="0,8,0,0"/>
              <Grid Grid.Row="2"
                    Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <ComboBox x:Name="LlmModelPresetComboBox"
                          Grid.Column="0"
                          MinWidth="200"
                          SelectionChanged="LlmModelPresetComboBox_SelectionChanged">
                  <ComboBoxItem Content="{DynamicResource Settings.LLM.ModelPreset.Phi3Mini}"
                                Tag="Phi3Mini4kQ4"/>
                  <ComboBoxItem Content="{DynamicResource Settings.LLM.ModelPreset.Custom}"
                                Tag="Custom"/>
                </ComboBox>
                <Button x:Name="LlmModelDownloadButton"
                        Grid.Column="1"
                        Content="{DynamicResource Settings.LLM.Download}"
                        Style="{StaticResource SecondaryButton}"
                        ap:ButtonIcon.Glyph="&#xe2c4;"
                        Margin="8,0,0,0"
                        Click="LlmModelDownloadButton_Click"/>
              </Grid>

              <!-- Download Progress -->
              <Grid Grid.Row="3"
                    x:Name="LlmDownloadProgressPanel"
                    Visibility="Collapsed"
                    Margin="0,0,0,8">
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <ProgressBar Grid.Row="0"
                             x:Name="LlmDownloadProgressBar"
                             Height="8"
                             Minimum="0"
                             Maximum="100"
                             Value="0"/>
                <TextBlock Grid.Row="1"
                           x:Name="LlmDownloadProgressText"
                           FontSize="{StaticResource FontSizeS}"
                           Foreground="{StaticResource TextMutedBrush}"
                           Margin="0,4,0,0"/>
              </Grid>

              <!-- Custom Model Path (only visible when Custom is selected) -->
              <TextBlock Grid.Row="4"
                         x:Name="LlmCustomPathLabel"
                         Text="{DynamicResource Settings.LLM.PathToModel}"
                         FontSize="{StaticResource FontSizeS}"
                         Foreground="{StaticResource TextMutedBrush}"
                         Margin="0,8,0,0"
                         Visibility="Collapsed"/>
              <Grid Grid.Row="5"
                    x:Name="LlmCustomPathPanel"
                    Visibility="Collapsed"
                    Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBox x:Name="LlmModelPathTextBox"
                         Grid.Column="0"
                         MinWidth="320"
                         HorizontalAlignment="Stretch"
                         ToolTip="{DynamicResource Settings.LLM.PathToModel.Tooltip}"/>
                <Button x:Name="LlmModelPathBrowseButton"
                        Grid.Column="1"
                        Content="{DynamicResource Settings.ChoosePath}"
                        Style="{StaticResource SecondaryButton}"
                        ap:ButtonIcon.Glyph="&#xe2c8;"
                        Margin="8,0,0,0"
                        Click="LlmModelPathBrowseButton_Click"/>
              </Grid>

              <!-- Model Type (only for Custom) -->
              <TextBlock Grid.Row="6"
                         x:Name="LlmModelTypeLabel"
                         Text="{DynamicResource Settings.LLM.ModelType}"
                         FontSize="{StaticResource FontSizeS}"
                         Foreground="{StaticResource TextMutedBrush}"
                         Margin="0,8,0,0"
                         Visibility="Collapsed"/>
              <ComboBox Grid.Row="7"
                        x:Name="LlmModelTypeComboBox"
                        MinWidth="200"
                        Visibility="Collapsed">
                <ComboBoxItem Content="{DynamicResource Settings.LLM.ModelType.Detect}"
                              Tag="Auto"
                              IsSelected="True"/>
                <ComboBoxItem Content="{DynamicResource Settings.LLM.ModelType.Phi3}"
                              Tag="Phi3"/>
                <ComboBoxItem Content="{DynamicResource Settings.LLM.ModelType.Mistral3}"
                              Tag="Mistral3"/>
              </ComboBox>

              <TextBlock Grid.Row="8"
                         Text="{DynamicResource Settings.LLM.SystemPrompt}"
                         FontSize="{StaticResource FontSizeS}"
                         Foreground="{StaticResource TextMutedBrush}"
                         Margin="0,8,0,0"/>
              <TextBox Grid.Row="9"
                       x:Name="LlmSystemPromptTextBox"
                       AcceptsReturn="True"
                       Height="80"
                       TextWrapping="Wrap"
                       VerticalScrollBarVisibility="Auto"/>

              <Grid Grid.Row="10"
                    Margin="0,8,0,0">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="{DynamicResource Common.Status}"
                           Foreground="{StaticResource TextMutedBrush}"
                           Margin="0,0,8,0"/>
                <TextBlock Grid.Column="1"
                           x:Name="LlmStatusTextBlock"
                           Text="{DynamicResource Settings.LLM.Status}"
                           Foreground="{StaticResource TextMutedBrush}"/>
              </Grid>
            </Grid>
          </GroupBox>

          <GroupBox Grid.Row="2"
                    Style="{StaticResource SettingsSectionGroupBox}"
                    Header="{DynamicResource Settings.LLM.Parameters}">
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>
              <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="{DynamicResource Settings.LLM.Parameters.MaxToken}"
                           Foreground="{StaticResource TextSecondaryBrush}"/>
                <Grid Grid.Column="1">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                  </Grid.ColumnDefinitions>
                  <TextBox x:Name="LlmMaxTokensTextBox"
                           Grid.Column="0"
                           Width="80"
                           Text="{DynamicResource Settings.LLM.Parameters.MaxToken.Default}"/>
                  <TextBlock Grid.Column="1"
                             Text="{DynamicResource Settings.LLM.MaxTokensHint}"
                             FontSize="{StaticResource FontSizeS}"
                             Foreground="{StaticResource TextMutedBrush}"
                             Margin="8,0,0,0"/>
                </Grid>
              </Grid>

              <Grid Grid.Row="1"
                    Margin="0,8,0,0">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="{DynamicResource Settings.LLM.Parameters.Temperature}"
                           Foreground="{StaticResource TextSecondaryBrush}"/>
                <Grid Grid.Column="1">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                  </Grid.ColumnDefinitions>
                  <Slider x:Name="LlmTemperatureSlider"
                          Grid.Column="0"
                          Width="160"
                          Minimum="0"
                          Maximum="1"
                          Value="0.3"
                          TickFrequency="0.1"
                          IsSnapToTickEnabled="True"
                          ValueChanged="LlmTemperatureSlider_ValueChanged"/>
                  <TextBlock x:Name="LlmTemperatureValueText"
                             Grid.Column="1"
                             Margin="8,0,0,0"
                             Width="40"
                             HorizontalAlignment="Left"
                             Text="{DynamicResource Settings.LLM.Parameters.Temperature.Default}"/>
                </Grid>
              </Grid>
            </Grid>
          </GroupBox>
        </Grid>

        <Grid Grid.Column="2">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="{StaticResource SpacingM}"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <GroupBox Grid.Row="0"
                    Style="{StaticResource SettingsSectionGroupBox}"
                    Header="{DynamicResource Settings.LLM.Prompts}">
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>
              <TextBlock Grid.Row="0"
                         Text="{DynamicResource Settings.LLM.Prompts.Title}"
                         FontSize="{StaticResource FontSizeS}"
                         Foreground="{StaticResource TextMutedBrush}"/>
              <TextBox Grid.Row="1"
                       x:Name="LlmTitleCustomPromptTextBox"
                       Height="60"
                       TextWrapping="Wrap"
                       AcceptsReturn="True"
                       VerticalScrollBarVisibility="Auto"/>

              <TextBlock Grid.Row="2"
                         Text="{DynamicResource Settings.LLM.Prompts.Description}"
                         FontSize="{StaticResource FontSizeS}"
                         Foreground="{StaticResource TextMutedBrush}"
                         Margin="0,8,0,0"/>
              <TextBox Grid.Row="3"
                       x:Name="LlmDescriptionCustomPromptTextBox"
                       Height="60"
                       TextWrapping="Wrap"
                       AcceptsReturn="True"
                       VerticalScrollBarVisibility="Auto"/>

              <TextBlock Grid.Row="4"
                         Text="{DynamicResource Settings.LLM.Prompts.Tags}"
                         FontSize="{StaticResource FontSizeS}"
                         Foreground="{StaticResource TextMutedBrush}"
                         Margin="0,8,0,0"/>
              <TextBox Grid.Row="5"
                       x:Name="LlmTagsCustomPromptTextBox"
                       Height="60"
                       TextWrapping="Wrap"
                       AcceptsReturn="True"
                       VerticalScrollBarVisibility="Auto"/>
            </Grid>
          </GroupBox>

          <GroupBox Grid.Row="2"
                    Style="{StaticResource SettingsSectionGroupBox}"
                    Header="{DynamicResource Settings.Suggestions.Count}">
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>
              <Grid Grid.Row="0"
                    Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="{DynamicResource Settings.Suggestions.Title}"
                           Foreground="{StaticResource TextSecondaryBrush}"/>
                <ComboBox Grid.Column="1"
                          x:Name="TitleSuggestionCountComboBox"
                          Width="120"
                          ItemsSource="{StaticResource SuggestionCountOptions}"/>
              </Grid>

              <Grid Grid.Row="1"
                    Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="{DynamicResource Settings.Suggestions.Description}"
                           Foreground="{StaticResource TextSecondaryBrush}"/>
                <ComboBox Grid.Column="1"
                          x:Name="DescriptionSuggestionCountComboBox"
                          Width="120"
                          ItemsSource="{StaticResource SuggestionCountOptions}"/>
              </Grid>

              <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="{DynamicResource Settings.Suggestions.Tags}"
                           Foreground="{StaticResource TextSecondaryBrush}"/>
                <ComboBox Grid.Column="1"
                          x:Name="TagsSuggestionCountComboBox"
                          Width="120"
                          ItemsSource="{StaticResource SuggestionCountOptions}"/>
              </Grid>
            </Grid>
          </GroupBox>
        </Grid>
      </Grid>
    </ScrollViewer>
  </Grid>
</UserControl>


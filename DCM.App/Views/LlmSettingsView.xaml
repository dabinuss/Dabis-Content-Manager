<UserControl x:Class="DCM.App.Views.LlmSettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ap="clr-namespace:DCM.App.Infrastructure.AttachedProperties"
             xmlns:sys="clr-namespace:System;assembly=mscorlib">
  <UserControl.Resources>
    <x:Array x:Key="SuggestionCountOptions"
             Type="{x:Type sys:Int32}">
      <sys:Int32>1</sys:Int32>
      <sys:Int32>2</sys:Int32>
      <sys:Int32>3</sys:Int32>
      <sys:Int32>4</sys:Int32>
      <sys:Int32>5</sys:Int32>
    </x:Array>
  </UserControl.Resources>
  <Grid Margin="{DynamicResource ViewRootMargin}">
    <Grid.RowDefinitions>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <ScrollViewer Grid.Row="0"
                  VerticalScrollBarVisibility="Auto">
      <Grid HorizontalAlignment="Stretch"
            MaxWidth="{DynamicResource SettingsContentMaxWidth}"
            VerticalAlignment="Top">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="{DynamicResource SpacingXXL}"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- LINKE SPALTE -->
        <Grid Grid.Column="0">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="{DynamicResource SpacingXL}"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>

          <!-- BOX 1: KI-Modell -->
          <GroupBox Grid.Row="0"
                    Style="{DynamicResource Control.GroupBox.Settings.Section}">
            <GroupBox.Header>
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="{DynamicResource Settings.LLM.Section.Model}" VerticalAlignment="Center"/>
                <Border Grid.Column="1" Style="{DynamicResource Control.Help.IconButton}"
                        ToolTip="{DynamicResource Settings.Tooltip.LlmMode.Example}">
                  <TextBlock Style="{DynamicResource Control.Help.IconGlyph}"/>
                </Border>
              </Grid>
            </GroupBox.Header>
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>

              <!-- Aktivierung -->
              <TextBlock Grid.Row="0"
                         Text="{DynamicResource Settings.LLM.Status.Label}"
                         Style="{DynamicResource Control.Text.Label}"/>
              <ComboBox Grid.Row="1"
                        x:Name="LlmModeComboBox"
                        MinWidth="{DynamicResource InputMinWidthM}"
                        SelectionChanged="LlmModeComboBox_SelectionChanged">
                <ComboBoxItem Content="{DynamicResource Settings.LLM.Off}"
                              Tag="Off"/>
                <ComboBoxItem Content="{DynamicResource Settings.LLM.Local}"
                              Tag="Local"/>
              </ComboBox>

              <!-- Modell-Auswahl -->
              <TextBlock Grid.Row="2"
                         Text="{DynamicResource Settings.LLM.Model.Select}"
                         Style="{DynamicResource Control.Text.Label}"
                         Margin="{DynamicResource LabelMarginTop}"/>
              <Grid Grid.Row="3">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <ComboBox x:Name="LlmModelPresetComboBox"
                          Grid.Column="0"
                          MinWidth="{DynamicResource InputMinWidthM}"
                          SelectionChanged="LlmModelPresetComboBox_SelectionChanged">
                  <ComboBoxItem Content="{DynamicResource Settings.LLM.ModelPreset.Phi3Mini}"
                                Tag="Phi3Mini4kQ4"/>
                  <ComboBoxItem Content="{DynamicResource Settings.LLM.ModelPreset.Custom}"
                                Tag="Custom"/>
                </ComboBox>
                <Button x:Name="LlmModelDownloadButton"
                        Grid.Column="1"
                        Content="{DynamicResource Settings.LLM.Download}"
                        Style="{DynamicResource Control.Button.Secondary}"
                        ap:ButtonIcon.Glyph="&#xe2c4;"
                        Margin="8,0,0,0"
                        Click="LlmModelDownloadButton_Click"/>
              </Grid>

              <!-- Download Progress -->
              <Grid Grid.Row="4"
                    x:Name="LlmDownloadProgressPanel"
                    Visibility="Collapsed"
                    Margin="{DynamicResource LabelMarginTop}">
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <ProgressBar Grid.Row="0"
                             x:Name="LlmDownloadProgressBar"
                             Height="{DynamicResource ProgressBarHeight}"
                             Minimum="0"
                             Maximum="100"
                             Value="0"/>
                <TextBlock Grid.Row="1"
                           x:Name="LlmDownloadProgressText"
                           FontSize="{DynamicResource FontSizeS}"
                           Foreground="{DynamicResource TextMutedBrush}"
                           Margin="{DynamicResource LabelMarginTopSmall}"/>
              </Grid>

              <!-- Eigenes Modell: Pfad -->
              <TextBlock Grid.Row="5"
                         x:Name="LlmCustomPathLabel"
                         Text="{DynamicResource Settings.LLM.Model.Path}"
                         Style="{DynamicResource Control.Text.Label}"
                         Margin="{DynamicResource LabelMarginTop}"
                         Visibility="Collapsed"/>
              <Grid Grid.Row="6"
                    x:Name="LlmCustomPathPanel"
                    Visibility="Collapsed">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBox x:Name="LlmModelPathTextBox"
                         Grid.Column="0"
                         MinWidth="{DynamicResource InputMinWidthXL}"
                         HorizontalAlignment="Stretch"
                         TextChanged="OnSettingChanged"/>
                <Button x:Name="LlmModelPathBrowseButton"
                        Grid.Column="1"
                        Content="{DynamicResource Settings.ChoosePath}"
                        Style="{DynamicResource Control.Button.Secondary}"
                        ap:ButtonIcon.Glyph="&#xe2c8;"
                        Margin="8,0,0,0"
                        Click="LlmModelPathBrowseButton_Click"/>
              </Grid>

              <!-- Eigenes Modell: Typ -->
              <TextBlock Grid.Row="7"
                         x:Name="LlmModelTypeLabel"
                         Text="{DynamicResource Settings.LLM.Model.Type}"
                         Style="{DynamicResource Control.Text.Label}"
                         Margin="{DynamicResource LabelMarginTop}"
                         Visibility="Collapsed"/>
              <ComboBox Grid.Row="8"
                        x:Name="LlmModelTypeComboBox"
                        MinWidth="{DynamicResource InputMinWidthM}"
                        Visibility="Collapsed"
                        SelectionChanged="OnComboBoxSettingChanged">
                <ComboBoxItem Content="{DynamicResource Settings.LLM.ModelType.Detect}"
                              Tag="Auto"
                              IsSelected="True"/>
                <ComboBoxItem Content="{DynamicResource Settings.LLM.ModelType.Phi3}"
                              Tag="Phi3"/>
                <ComboBoxItem Content="{DynamicResource Settings.LLM.ModelType.Mistral3}"
                              Tag="Mistral3"/>
              </ComboBox>

              <!-- Status -->
              <Grid Grid.Row="9" Margin="{DynamicResource LabelMarginTop}">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto"/>
                  <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="{DynamicResource Settings.LLM.Model.Status}"
                           Foreground="{DynamicResource TextMutedBrush}"
                           Margin="0,0,8,0"/>
                <TextBlock Grid.Column="1"
                           x:Name="LlmStatusTextBlock"
                           Text="{DynamicResource Settings.LLM.Status}"
                           Foreground="{DynamicResource TextMutedBrush}"/>
              </Grid>
            </Grid>
          </GroupBox>

          <!-- BOX 2: Generierung -->
          <GroupBox Grid.Row="2"
                    Style="{DynamicResource Control.GroupBox.Settings.Section}">
            <GroupBox.Header>
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="{DynamicResource Settings.LLM.Section.Generation}" VerticalAlignment="Center"/>
                <Border Grid.Column="1" Style="{DynamicResource Control.Help.IconButton}"
                        ToolTip="{DynamicResource Settings.Tooltip.LlmParameters.Example}">
                  <TextBlock Style="{DynamicResource Control.Help.IconGlyph}"/>
                </Border>
              </Grid>
            </GroupBox.Header>
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>

              <!-- Max Tokens -->
              <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="{DynamicResource Settings.LLM.Generation.MaxTokens}"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                  <TextBox x:Name="LlmMaxTokensTextBox"
                           Width="{DynamicResource InputMinWidthXS}"
                           Text="{DynamicResource Settings.LLM.Parameters.MaxToken.Default}"
                           TextChanged="OnSettingChanged"/>
                  <TextBlock Text="{DynamicResource Settings.LLM.MaxTokensHint}"
                             FontSize="{DynamicResource FontSizeXS}"
                             Foreground="{DynamicResource TextMutedBrush}"
                             VerticalAlignment="Center"
                             Margin="8,0,0,0"/>
                </StackPanel>
              </Grid>

              <!-- Temperatur -->
              <Grid Grid.Row="1" Margin="{DynamicResource LabelMarginTop}">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="{DynamicResource Settings.LLM.Generation.Creativity}"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                  <Slider x:Name="LlmTemperatureSlider"
                          Width="{DynamicResource SliderWidth}"
                          Minimum="0"
                          Maximum="1"
                          Value="0.3"
                          TickFrequency="0.1"
                          IsSnapToTickEnabled="True"
                          VerticalAlignment="Center"
                          ValueChanged="LlmTemperatureSlider_ValueChanged"/>
                  <TextBlock x:Name="LlmTemperatureValueText"
                             Width="30"
                             Margin="8,0,0,0"
                             VerticalAlignment="Center"
                             Text="{DynamicResource Settings.LLM.Parameters.Temperature.Default}"/>
                </StackPanel>
              </Grid>

              <!-- System Prompt -->
              <TextBlock Grid.Row="2"
                         Text="{DynamicResource Settings.LLM.Generation.SystemPrompt}"
                         Style="{DynamicResource Control.Text.Label}"
                         Margin="{DynamicResource LabelMarginTop}"/>
              <TextBox Grid.Row="3"
                       x:Name="LlmSystemPromptTextBox"
                       AcceptsReturn="True"
                       Height="80"
                       TextWrapping="Wrap"
                       VerticalScrollBarVisibility="Auto"
                       TextChanged="OnSettingChanged"/>
            </Grid>
          </GroupBox>
        </Grid>

        <!-- RECHTE SPALTE -->
        <Grid Grid.Column="2">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="{DynamicResource SpacingXL}"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>

          <!-- BOX 3: Anweisungen -->
          <GroupBox Grid.Row="0"
                    Style="{DynamicResource Control.GroupBox.Settings.Section}">
            <GroupBox.Header>
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="{DynamicResource Settings.LLM.Section.Instructions}" VerticalAlignment="Center"/>
                <Border Grid.Column="1" Style="{DynamicResource Control.Help.IconButton}"
                        ToolTip="{DynamicResource Settings.Tooltip.LlmPrompts.Example}">
                  <TextBlock Style="{DynamicResource Control.Help.IconGlyph}"/>
                </Border>
              </Grid>
            </GroupBox.Header>
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>

              <!-- Titel-Anweisungen -->
              <TextBlock Grid.Row="0"
                         Text="{DynamicResource Settings.LLM.Instructions.Title}"
                         Style="{DynamicResource Control.Text.Label}"/>
              <TextBox Grid.Row="1"
                       x:Name="LlmTitleCustomPromptTextBox"
                       Height="60"
                       TextWrapping="Wrap"
                       AcceptsReturn="True"
                       VerticalScrollBarVisibility="Auto"
                       TextChanged="OnSettingChanged"/>

              <!-- Beschreibungs-Anweisungen -->
              <TextBlock Grid.Row="2"
                         Text="{DynamicResource Settings.LLM.Instructions.Description}"
                         Style="{DynamicResource Control.Text.Label}"
                         Margin="{DynamicResource LabelMarginTop}"/>
              <TextBox Grid.Row="3"
                       x:Name="LlmDescriptionCustomPromptTextBox"
                       Height="60"
                       TextWrapping="Wrap"
                       AcceptsReturn="True"
                       VerticalScrollBarVisibility="Auto"
                       TextChanged="OnSettingChanged"/>

              <!-- Tags-Anweisungen -->
              <TextBlock Grid.Row="4"
                         Text="{DynamicResource Settings.LLM.Instructions.Tags}"
                         Style="{DynamicResource Control.Text.Label}"
                         Margin="{DynamicResource LabelMarginTop}"/>
              <TextBox Grid.Row="5"
                       x:Name="LlmTagsCustomPromptTextBox"
                       Height="60"
                       TextWrapping="Wrap"
                       AcceptsReturn="True"
                       VerticalScrollBarVisibility="Auto"
                       TextChanged="OnSettingChanged"/>
            </Grid>
          </GroupBox>

          <!-- BOX 4: VorschlÃ¤ge -->
          <GroupBox Grid.Row="2"
                    Style="{DynamicResource Control.GroupBox.Settings.Section}">
            <GroupBox.Header>
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="{DynamicResource Settings.LLM.Section.Suggestions}" VerticalAlignment="Center"/>
                <Border Grid.Column="1" Style="{DynamicResource Control.Help.IconButton}"
                        ToolTip="{DynamicResource Settings.Tooltip.SuggestionCount.Example}">
                  <TextBlock Style="{DynamicResource Control.Help.IconGlyph}"/>
                </Border>
              </Grid>
            </GroupBox.Header>
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>

              <!-- Titel -->
              <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="{DynamicResource Settings.LLM.Suggestions.Title}"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           VerticalAlignment="Center"/>
                <ComboBox Grid.Column="1"
                          x:Name="TitleSuggestionCountComboBox"
                          Width="{DynamicResource InputMinWidthXS}"
                          ItemsSource="{StaticResource SuggestionCountOptions}"
                          SelectionChanged="OnComboBoxSettingChanged"/>
              </Grid>

              <!-- Beschreibung -->
              <Grid Grid.Row="1" Margin="{DynamicResource LabelMarginTop}">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="{DynamicResource Settings.LLM.Suggestions.Description}"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           VerticalAlignment="Center"/>
                <ComboBox Grid.Column="1"
                          x:Name="DescriptionSuggestionCountComboBox"
                          Width="{DynamicResource InputMinWidthXS}"
                          ItemsSource="{StaticResource SuggestionCountOptions}"
                          SelectionChanged="OnComboBoxSettingChanged"/>
              </Grid>

              <!-- Tags -->
              <Grid Grid.Row="2" Margin="{DynamicResource LabelMarginTop}">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="{DynamicResource Settings.LLM.Suggestions.Tags}"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           VerticalAlignment="Center"/>
                <ComboBox Grid.Column="1"
                          x:Name="TagsSuggestionCountComboBox"
                          Width="{DynamicResource InputMinWidthXS}"
                          ItemsSource="{StaticResource SuggestionCountOptions}"
                          SelectionChanged="OnComboBoxSettingChanged"/>
              </Grid>
            </Grid>
          </GroupBox>
        </Grid>
      </Grid>
    </ScrollViewer>
  </Grid>
</UserControl>


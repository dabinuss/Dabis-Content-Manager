<UserControl x:Class="DCM.App.Views.UploadView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="clr-namespace:DCM.App.Models"
             xmlns:core="clr-namespace:DCM.Core.Models;assembly=DCM.Core"
             xmlns:config="clr-namespace:DCM.Core.Configuration;assembly=DCM.Core"
             xmlns:conv="clr-namespace:DCM.App.Infrastructure.Converters">
  <UserControl.Resources>
    <conv:HeightToWidthConverter x:Key="HeightToWidth16x9"
                                 Ratio="1.7777777777777777"/>
  </UserControl.Resources>
  <Grid x:Name="RootGrid"
      Margin="0,0,8,0">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="{StaticResource SpacingL}"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <!-- HEADER -->
    <StackPanel x:Name="HeaderPanel"
                Grid.Row="0"
                Visibility="Collapsed"/>

    <!-- MULTIUPLOAD + DETAILS CONTAINER -->
    <Border Grid.Row="1"
            Style="{StaticResource SurfaceCard}"
            Padding="{StaticResource SpacingAllM}"
            Margin="0,0,0,8">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="{StaticResource SpacingM}"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="{StaticResource SpacingM}"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="{StaticResource SpacingM}"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="{StaticResource SpacingM}"/>
          <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <DockPanel Grid.Row="0"
                   LastChildFill="True">
          <TextBlock Text="Multiupload"
                     Style="{StaticResource SectionHeader}"
                     DockPanel.Dock="Left"/>
        </DockPanel>

        <ListBox x:Name="UploadItemsListBox"
                 Grid.Row="2"
                 BorderThickness="0"
                 Background="{x:Null}"
                 SelectionMode="Single"
                 ScrollViewer.HorizontalScrollBarVisibility="Auto"
                 ScrollViewer.VerticalScrollBarVisibility="Disabled"
                 SelectionChanged="UploadItemsListBox_SelectionChanged">
          <ListBox.ItemsPanel>
            <ItemsPanelTemplate>
              <StackPanel Orientation="Horizontal"/>
            </ItemsPanelTemplate>
          </ListBox.ItemsPanel>
          <ListBox.ItemContainerStyle>
            <Style TargetType="ListBoxItem">
              <Setter Property="Margin"
                      Value="0,0,8,0"/>
              <Setter Property="Padding"
                      Value="0"/>
              <Setter Property="HorizontalContentAlignment"
                      Value="Stretch"/>
            </Style>
          </ListBox.ItemContainerStyle>
          <ListBox.ItemTemplate>
            <DataTemplate>
              <Border Style="{StaticResource SurfaceCard}"
                      CornerRadius="{StaticResource RadiusM}"
                      Padding="{StaticResource SpacingAllM}"
                      Width="260">
                <Grid>
                  <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                  </Grid.RowDefinitions>

                  <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="*"/>
                      <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel>
                      <TextBlock Text="{Binding DisplayName}"
                                 FontWeight="SemiBold"
                                 FontSize="{StaticResource FontSizeM}"
                                 Foreground="{StaticResource TextPrimaryBrush}"
                                 TextTrimming="CharacterEllipsis"/>
                      <TextBlock Text="{Binding FileSizeDisplay}"
                                 FontSize="{StaticResource FontSizeXS}"
                                 Foreground="{StaticResource TextMutedBrush}"
                                 Margin="0,2,0,0"/>
                    </StackPanel>
                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right">
                      <Button Content="{DynamicResource Common.Remove}"
                              Style="{StaticResource SecondaryButton}"
                              Tag="{Binding}"
                              Click="RemoveDraftButton_Click"
                              Margin="8,0,0,0"
                              Padding="8,2"/>
                      <Button Content="{DynamicResource Upload.Upload.Cancel}"
                              Tag="{Binding}"
                              Click="CancelDraftUploadButton_Click"
                              Margin="8,0,0,0"
                              Padding="8,2">
                        <Button.Style>
                          <Style TargetType="Button"
                                 BasedOn="{StaticResource SecondaryButton}">
                            <Setter Property="Visibility"
                                    Value="Collapsed"/>
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding UploadState}"
                                           Value="{x:Static models:UploadDraftUploadState.Uploading}">
                                <Setter Property="Visibility"
                                        Value="Visible"/>
                              </DataTrigger>
                            </Style.Triggers>
                          </Style>
                        </Button.Style>
                      </Button>
                    </StackPanel>
                  </Grid>

                  <Grid Grid.Row="1"
                        Margin="0,8,0,0">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="*"/>
                      <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                      <TextBlock Text="Upload"
                                 FontSize="{StaticResource FontSizeS}"
                                 Foreground="{StaticResource TextMutedBrush}"/>
                      <StackPanel Orientation="Horizontal"
                                  Margin="0,8,0,0">
                        <TextBlock>
                          <TextBlock.Style>
                            <Style TargetType="TextBlock"
                                   BasedOn="{StaticResource IconM}">
                              <Setter Property="Text"
                                      Value="&#xe5c3;"/>
                              <Setter Property="Foreground"
                                      Value="{StaticResource TextMutedBrush}"/>
                              <Style.Triggers>
                                <DataTrigger Binding="{Binding UploadState}"
                                             Value="{x:Static models:UploadDraftUploadState.Completed}">
                                  <Setter Property="Text"
                                          Value="&#xe86c;"/>
                                  <Setter Property="Foreground"
                                          Value="{StaticResource SuccessBrush}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding UploadState}"
                                             Value="{x:Static models:UploadDraftUploadState.Uploading}">
                                  <Setter Property="Text"
                                          Value="&#xe863;"/>
                                  <Setter Property="Foreground"
                                          Value="{StaticResource PrimaryBrush}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding UploadState}"
                                             Value="{x:Static models:UploadDraftUploadState.Failed}">
                                  <Setter Property="Text"
                                          Value="&#xe000;"/>
                                  <Setter Property="Foreground"
                                          Value="{StaticResource DangerBrush}"/>
                                </DataTrigger>
                              </Style.Triggers>
                            </Style>
                          </TextBlock.Style>
                        </TextBlock>
                        <TextBlock Text="{Binding UploadStatus}"
                                   FontSize="{StaticResource FontSizeS}"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="8,0,0,0"
                                   TextWrapping="Wrap"
                                   MaxWidth="160"/>
                      </StackPanel>
                    </StackPanel>

                    <StackPanel Grid.Column="1">
                      <TextBlock Text="Transkript"
                                 FontSize="{StaticResource FontSizeS}"
                                 Foreground="{StaticResource TextMutedBrush}"/>
                      <StackPanel Orientation="Horizontal"
                                  Margin="0,8,0,0">
                        <TextBlock>
                          <TextBlock.Style>
                            <Style TargetType="TextBlock"
                                   BasedOn="{StaticResource IconM}">
                              <Setter Property="Text"
                                      Value="&#xe8d1;"/>
                              <Setter Property="Foreground"
                                      Value="{StaticResource TextMutedBrush}"/>
                              <Style.Triggers>
                                <DataTrigger Binding="{Binding TranscriptionState}"
                                             Value="{x:Static models:UploadDraftTranscriptionState.Completed}">
                                  <Setter Property="Text"
                                          Value="&#xe86c;"/>
                                  <Setter Property="Foreground"
                                          Value="{StaticResource SuccessBrush}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding TranscriptionState}"
                                             Value="{x:Static models:UploadDraftTranscriptionState.Running}">
                                  <Setter Property="Text"
                                          Value="&#xe863;"/>
                                  <Setter Property="Foreground"
                                          Value="{StaticResource PrimaryBrush}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding TranscriptionState}"
                                             Value="{x:Static models:UploadDraftTranscriptionState.Failed}">
                                  <Setter Property="Text"
                                          Value="&#xe000;"/>
                                  <Setter Property="Foreground"
                                          Value="{StaticResource DangerBrush}"/>
                                </DataTrigger>
                              </Style.Triggers>
                            </Style>
                          </TextBlock.Style>
                        </TextBlock>
                        <TextBlock Text="{Binding TranscriptionStatus}"
                                   FontSize="{StaticResource FontSizeS}"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="8,0,0,0"
                                   TextWrapping="Wrap"
                                  MaxWidth="160"/>
                      </StackPanel>
                      <StackPanel Orientation="Horizontal"
                                  Margin="0,8,0,0">
                        <StackPanel.Style>
                          <Style TargetType="StackPanel">
                            <Setter Property="Visibility"
                                    Value="Collapsed"/>
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding TranscriptionState}"
                                           Value="{x:Static models:UploadDraftTranscriptionState.Pending}">
                                <Setter Property="Visibility"
                                        Value="Visible"/>
                              </DataTrigger>
                            </Style.Triggers>
                          </Style>
                        </StackPanel.Style>
                        <Button Content="{DynamicResource Upload.Transcription.Queue.Prioritize}"
                                Style="{StaticResource SecondaryButton}"
                                Tag="{Binding}"
                                Click="TranscriptionQueuePrioritizeButton_Click"
                                Padding="8,2"/>
                        <Button Content="{DynamicResource Upload.Transcription.Queue.Skip}"
                                Style="{StaticResource SecondaryButton}"
                                Tag="{Binding}"
                                Click="TranscriptionQueueSkipButton_Click"
                                Padding="8,2"
                                Margin="8,0,0,0"/>
                      </StackPanel>
                    </StackPanel>
                  </Grid>

                  <ProgressBar Grid.Row="2"
                               Margin="0,8,0,0"
                               Minimum="0"
                               Maximum="100"
                               Value="{Binding UploadProgress}"
                               IsIndeterminate="{Binding IsUploadProgressIndeterminate}"/>

                  <ProgressBar Grid.Row="3"
                               Margin="0,8,0,0"
                               Minimum="0"
                               Maximum="100"
                               Value="{Binding TranscriptionProgress}"
                               IsIndeterminate="{Binding IsTranscriptionProgressIndeterminate}"/>
                </Grid>
              </Border>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>

        <Border Grid.Row="4"
                Height="1"
                Background="{StaticResource BorderBrush}"/>
        <TextBlock Grid.Row="6"
                   Text="{DynamicResource Upload.Section.Details}"
                   Style="{StaticResource SectionHeader}"/>

        <ContentControl x:Name="VideoDropZone"
                Grid.Row="8"
                Style="{StaticResource VideoDropZoneStyle}"
                DragOver="VideoDrop_DragOver"
                DragLeave="VideoDrop_DragLeave"
                Drop="VideoDrop_Drop"
                MouseLeftButtonDown="VideoDropZone_Click">

      <Grid>
        <!-- Zustand 1: Kein Video ausgewählt -->
        <Grid x:Name="VideoDropEmptyState"
              Visibility="Visible">
          <StackPanel HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Margin="20">
            <TextBlock Style="{StaticResource Icon64}"
                       Text="&#xe070;"
                       HorizontalAlignment="Center"
                       Margin="{StaticResource SpacingVerticalS}"/>
            <TextBlock Text="{DynamicResource Upload.DropVideo}"
                       FontSize="{StaticResource FontSizeXL}"
                       FontWeight="SemiBold"
                       Foreground="{StaticResource TextPrimaryBrush}"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="{DynamicResource Upload.DropVideo.Descr}"
                       FontSize="{StaticResource FontSizeM}"
                       Foreground="{StaticResource TextMutedBrush}"
                       HorizontalAlignment="Center"
                       Margin="0,8,0,0"/>
            <TextBlock Text="{DynamicResource Upload.DropVideo.AllowedFiles}"
                       FontSize="{StaticResource FontSizeXS}"
                       Foreground="{StaticResource TextMutedBrush}"
                       HorizontalAlignment="Center"
                       Margin="0,8,0,0"/>
          </StackPanel>
        </Grid>

        <!-- Zustand 2: Video ausgewählt -->
        <Grid x:Name="VideoDropSelectedState"
              Visibility="Collapsed">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>

          <!-- Video Preview -->
          <Border Grid.Column="0"
                  Width="{Binding ElementName=VideoInfoPanel, Path=ActualHeight, Converter={StaticResource HeightToWidth16x9}}"
                  Height="{Binding ElementName=VideoInfoPanel, Path=ActualHeight}"
                  MinWidth="160"
                  MinHeight="90"
                  CornerRadius="{StaticResource RadiusM}"
                  Background="{StaticResource SurfaceLightBrush}"
                  BorderBrush="{StaticResource BorderStrongBrush}"
                  BorderThickness="0.5"
                  Margin="8,8,8,8"
                  VerticalAlignment="Top"
                  ClipToBounds="True">
            <Grid>
              <Grid x:Name="VideoPreviewEmptyState">
                <TextBlock Style="{StaticResource IconXXL}"
                           Text="&#xe53f;"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Margin="0"/>
              </Grid>
              <Image x:Name="VideoPreviewImage"
                     Stretch="UniformToFill"
                     Visibility="Collapsed"/>
            </Grid>
          </Border>

          <!-- Video Info -->
          <Grid x:Name="VideoInfoPanel"
                Grid.Column="1"
                VerticalAlignment="Top"
                Margin="0,8,0,8">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="{StaticResource SpacingM}"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Grid Grid.Row="0">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
              </Grid.ColumnDefinitions>
              <TextBlock x:Name="VideoFileNameTextBlock"
                         Text="video.mp4"
                         FontSize="{StaticResource FontSizeL}"
                         FontWeight="SemiBold"
                         Foreground="{StaticResource TextPrimaryBrush}"
                         TextTrimming="CharacterEllipsis"/>
              <TextBlock x:Name="VideoFileSizeTextBlock"
                         Grid.Column="1"
                         Text="0 MB"
                         FontSize="{StaticResource FontSizeS}"
                         Foreground="{StaticResource TextMutedBrush}"
                         Margin="8,0,0,0"
                         VerticalAlignment="Center"/>
            </Grid>

            <Border Grid.Row="2"
                    Background="{StaticResource SurfaceSunkenBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="{StaticResource RadiusS}"
                    Padding="8">
              <UniformGrid Columns="3"
                           Rows="3">
                <Border BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="0,0,1,1"
                        Padding="8,8">
                  <StackPanel>
                    <TextBlock Text="{DynamicResource Upload.VideoInfo.Resolution}"
                               FontSize="{StaticResource FontSizeXS}"
                               Foreground="{StaticResource TextMutedBrush}"/>
                    <TextBlock x:Name="VideoResolutionTextBlock"
                               FontSize="{StaticResource FontSizeM}"
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                  </StackPanel>
                </Border>

                <Border BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="0,0,1,1"
                        Padding="8,8">
                  <StackPanel>
                    <TextBlock Text="{DynamicResource Upload.VideoInfo.Fps}"
                               FontSize="{StaticResource FontSizeXS}"
                               Foreground="{StaticResource TextMutedBrush}"/>
                    <TextBlock x:Name="VideoFpsTextBlock"
                               FontSize="{StaticResource FontSizeM}"
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                  </StackPanel>
                </Border>

                <Border BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="0,0,0,1"
                        Padding="8,8">
                  <StackPanel>
                    <TextBlock Text="{DynamicResource Upload.VideoInfo.Duration}"
                               FontSize="{StaticResource FontSizeXS}"
                               Foreground="{StaticResource TextMutedBrush}"/>
                    <TextBlock x:Name="VideoDurationTextBlock"
                               FontSize="{StaticResource FontSizeM}"
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                  </StackPanel>
                </Border>

                <Border BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="0,0,1,1"
                        Padding="8,8">
                  <StackPanel>
                    <TextBlock Text="{DynamicResource Upload.VideoInfo.VideoCodec}"
                               FontSize="{StaticResource FontSizeXS}"
                               Foreground="{StaticResource TextMutedBrush}"/>
                    <TextBlock x:Name="VideoCodecTextBlock"
                               FontSize="{StaticResource FontSizeM}"
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                  </StackPanel>
                </Border>

                <Border BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="0,0,1,1"
                        Padding="8,8">
                  <StackPanel>
                    <TextBlock Text="{DynamicResource Upload.VideoInfo.VideoBitrate}"
                               FontSize="{StaticResource FontSizeXS}"
                               Foreground="{StaticResource TextMutedBrush}"/>
                    <TextBlock x:Name="VideoBitrateTextBlock"
                               FontSize="{StaticResource FontSizeM}"
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                  </StackPanel>
                </Border>

                <Border BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="0,0,0,1"
                        Padding="8,8">
                  <StackPanel>
                    <TextBlock Text="{DynamicResource Upload.VideoInfo.Audio}"
                               FontSize="{StaticResource FontSizeXS}"
                               Foreground="{StaticResource TextMutedBrush}"/>
                    <TextBlock x:Name="VideoAudioTextBlock"
                               FontSize="{StaticResource FontSizeM}"
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                  </StackPanel>
                </Border>

                <Border BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="0,0,1,0"
                        Padding="8,8">
                  <StackPanel>
                    <TextBlock Text="{DynamicResource Upload.VideoInfo.AudioBitrate}"
                               FontSize="{StaticResource FontSizeXS}"
                               Foreground="{StaticResource TextMutedBrush}"/>
                    <TextBlock x:Name="VideoAudioBitrateTextBlock"
                               FontSize="{StaticResource FontSizeM}"
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                  </StackPanel>
                </Border>

                <Border BorderThickness="0"
                        Padding="8,8"/>
                <Border BorderThickness="0"
                        Padding="8,8"/>
              </UniformGrid>
            </Border>
          </Grid>

          <!-- Buttons -->
          <StackPanel Grid.Column="2"
                      VerticalAlignment="Top"
                      Margin="8,8,8,8">
            <Button x:Name="VideoChangeButton"
                    Content="{DynamicResource Common.Change}"
                    Style="{StaticResource SecondaryButton}"
                    Click="VideoChangeButton_Click"
                    MinWidth="140"
                    Margin="0,8,0,8"/>
            <Button x:Name="UploadButton"
                    Style="{StaticResource SecondaryButton}"
                    Click="UploadButton_Click"
                    IsEnabled="False"
                    MinWidth="140"
                    Padding="8,8">
              <StackPanel Orientation="Horizontal">
                <TextBlock Style="{StaticResource IconXL}"
                           Text="&#xeb9b;"/>
                <TextBlock Text="{DynamicResource Upload.StartUpload}"/>
              </StackPanel>
            </Button>
          </StackPanel>
        </Grid>
      </Grid>
      </ContentControl>
    </Grid>
  </Border>

    <!-- Verstecktes TextBox für Pfad -->
    <TextBox x:Name="VideoPathTextBox"
             Grid.Row="2"
             Visibility="Collapsed"/>

    <!-- ZWEI-SPALTEN-LAYOUT -->
    <Grid x:Name="MainContentGrid"
        Grid.Row="4">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"
                          MinWidth="350"/>
        <ColumnDefinition Width="{StaticResource SpacingL}"/>
        <ColumnDefinition Width="*"
                          MinWidth="300"
                          MaxWidth="400"/>
      </Grid.ColumnDefinitions>

      <!-- LINKE SPALTE -->
      <Grid x:Name="LeftColumnPanel"
            Grid.Column="0">
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="{StaticResource SpacingS}"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="{StaticResource SpacingS}"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="{StaticResource SpacingS}"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="{StaticResource SpacingS}"/>
          <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0"
                   Text="{DynamicResource Section.Metadata}"
                   Style="{StaticResource SectionHeader}"
                   Margin="0,0,0,8"/>

        <!-- Titel -->
        <GroupBox Grid.Row="2"
                  Tag="{Binding ElementName=TitleTextBox}"
                  Header="{DynamicResource Upload.Fields.Title}"
                  PreviewMouseDown="FocusTargetOnContainerClick">
          <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="{StaticResource SpacingM}"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="{StaticResource SpacingM}"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>

              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
              </Grid.ColumnDefinitions>

              <TextBox x:Name="TitleTextBox"
                       Grid.Row="2"
                       Grid.Column="0"
                       Grid.ColumnSpan="2"
                       TextChanged="TitleTextBox_TextChanged"/>
              <Button x:Name="GenerateTitleButton"
                      Grid.Row="4"
                      Grid.Column="0"
                      Style="{StaticResource SecondaryButton}"
                      Click="GenerateTitleButton_Click"
                      ToolTip="KI-Vorschlag generieren"
                      BorderBrush="{StaticResource MagicAIGradientBrush}">
                <StackPanel Orientation="Horizontal">
                  <TextBlock Style="{StaticResource IconL}"
                             Foreground="{StaticResource MagicAIGradientBrush}"
                             Text="&#xe663;"/>
                  <TextBlock Text="{DynamicResource Upload.Fields.Suggest}"/>
                </StackPanel>
              </Button>
          </Grid>
        </GroupBox>

        <!-- Beschreibung -->
        <GroupBox Grid.Row="4"
                  Tag="{Binding ElementName=DescriptionTextBox}"
                  Header="{DynamicResource Upload.Fields.Description}"
                  PreviewMouseDown="FocusTargetOnContainerClick">
          <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="{StaticResource SpacingM}"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>

              <TextBox x:Name="DescriptionTextBox"
                       Grid.Row="0"
                       AcceptsReturn="True"
                       VerticalScrollBarVisibility="Auto"
                       TextWrapping="Wrap"
                       TextChanged="DescriptionTextBox_TextChanged"
                       MinHeight="140"/>

              <!-- Template & Buttons -->
              <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto"/>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Button x:Name="GenerateDescriptionButton"
                        Grid.Column="0"
                        Style="{StaticResource SecondaryButton}"
                        Click="GenerateDescriptionButton_Click"
                        ToolTip="KI-Vorschlag generieren"
                        BorderBrush="{StaticResource MagicAIGradientBrush}">
                  <StackPanel Orientation="Horizontal">
                    <TextBlock Style="{StaticResource IconL}"
                               Foreground="{StaticResource MagicAIGradientBrush}"
                               Text="&#xe663;"/>
                    <TextBlock Text="{DynamicResource Upload.Fields.Suggest}"/>
                  </StackPanel>
                </Button>
                <ComboBox x:Name="TemplateComboBox"
                          Grid.Column="1"
                          DisplayMemberPath="Name"
                          ToolTip="Template fuer die Beschreibung"
                          SelectionChanged="TemplateComboBox_SelectionChanged"
                          Margin="0,0,8,0"/>
                <Button x:Name="ApplyTemplateButton"
                        Grid.Column="2"
                        Content="{DynamicResource Common.Apply}"
                        Style="{StaticResource SecondaryButton}"
                        Click="ApplyTemplateButton_Click"
                        Margin="0,0,8,0"/>
              </Grid>
          </Grid>
        </GroupBox>

        <!-- Tags -->
        <GroupBox Grid.Row="6"
                  Tag="{Binding ElementName=TagsTextBox}"
                  Header="{DynamicResource Upload.Fields.Tags}"
                  PreviewMouseDown="FocusTargetOnContainerClick">
          <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="{StaticResource SpacingM}"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>

              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
              </Grid.ColumnDefinitions>

              <TextBox x:Name="TagsTextBox"
                       Grid.Row="0"
                       Grid.Column="0"
                       Grid.ColumnSpan="2"
                       ToolTip="Tags, kommagetrennt (z. B. lets play, gaming, deutsch)"
                       TextChanged="TagsTextBox_TextChanged"/>
              <Button x:Name="GenerateTagsButton"
                      Grid.Row="2"
                      Grid.Column="0"
                      Style="{StaticResource SecondaryButton}"
                      Click="GenerateTagsButton_Click"
                      ToolTip="KI-Vorschlag generieren"
                      BorderBrush="{StaticResource MagicAIGradientBrush}">
                <StackPanel Orientation="Horizontal">
                  <TextBlock Style="{StaticResource IconL}"
                             Foreground="{StaticResource MagicAIGradientBrush}"
                             Text="&#xe663;"/>
                  <TextBlock Text="{DynamicResource Upload.Fields.Suggest}"/>
                </StackPanel>
              </Button>
          </Grid>
        </GroupBox>

        <!-- Transkript -->
        <GroupBox Grid.Row="8"
                  Tag="{Binding ElementName=TranscriptTextBox}"
                  Header="{DynamicResource Upload.Fields.Transcription}"
                  PreviewMouseDown="FocusTargetOnContainerClick">
          <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="{StaticResource SpacingM}"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="{StaticResource SpacingM}"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>

              <TextBlock Grid.Row="0"
                         Text="{DynamicResource Upload.Fields.Transcription.Descr}"
                         FontSize="{StaticResource FontSizeS}"
                         Foreground="{StaticResource TextMutedBrush}"/>

              <TextBox x:Name="TranscriptTextBox"
                       Grid.Row="2"
                       AcceptsReturn="True"
                       VerticalScrollBarVisibility="Auto"
                       TextWrapping="Wrap"
                       MinHeight="140"
                       TextChanged="TranscriptTextBox_TextChanged"/>

              <!-- Transkription Controls -->
              <Grid Grid.Row="4">
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="{StaticResource SpacingS}"/>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto"/>
                  <!-- Transkribieren -->
                  <ColumnDefinition Width="Auto"/>
                  <!-- Export -->
                  <ColumnDefinition Width="*"/>
                  <!-- Progress -->
                </Grid.ColumnDefinitions>

                <Button x:Name="TranscribeButton"
                        Grid.Row="0"
                        Grid.Column="0"
                        Click="TranscribeButton_Click"
                        IsEnabled="False"
                        Tag="default"
                        ToolTip="Video automatisch transkribieren">
                  <Button.Style>
                    <Style TargetType="Button"
                           BasedOn="{StaticResource SecondaryButton}">
                      <!-- Default State -->
                      <Setter Property="Content">
                        <Setter.Value>
                          <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource IconL}"
                                       Text="&#xe048;"/>
                            <TextBlock Text="{DynamicResource Upload.Fields.Transcripe}"/>
                          </StackPanel>
                        </Setter.Value>
                      </Setter>
                      <!-- Active State -->
                      <Style.Triggers>
                        <Trigger Property="Tag"
                                 Value="active">
                          <Setter Property="Content">
                            <Setter.Value>
                              <StackPanel Orientation="Horizontal">
                                <TextBlock Style="{StaticResource IconL}"
                                           Text="&#xe5c9;"/>
                                <TextBlock Text="{DynamicResource Common.Cancel}"/>
                              </StackPanel>
                            </Setter.Value>
                          </Setter>
                        </Trigger>
                      </Style.Triggers>
                    </Style>
                  </Button.Style>
                </Button>

                <Button x:Name="TranscriptionExportButton"
                        Grid.Row="0"
                        Grid.Column="1"
                        Style="{StaticResource SecondaryButton}"
                        Click="TranscriptionExportButton_Click"
                        ToolTip="Transkript als Textdatei exportieren"
                        Margin="8,0,0,0">
                  <TextBlock Style="{StaticResource IconXL}"
                             Text="&#xe168;"
                             Margin="0"/>
                </Button>

                <ProgressBar x:Name="TranscriptionProgressBar"
                             Grid.Row="0"
                             Grid.Column="2"
                             Height="20"
                             Margin="{StaticResource SpacingHorizontalM}"
                             Minimum="0"
                             Maximum="100"
                             Value="0"
                             Visibility="Collapsed"/>

                <TextBlock x:Name="TranscriptionPhaseTextBlock"
                           Grid.Row="2"
                           Grid.Column="0"
                           Grid.ColumnSpan="3"
                           FontSize="{StaticResource FontSizeS}"
                           Foreground="{StaticResource TextMutedBrush}"
                           Visibility="Collapsed"/>
              </Grid>
          </Grid>
        </GroupBox>

      </Grid>

      <!-- RECHTE SPALTE -->
      <Grid Grid.Column="2">
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="{StaticResource SpacingS}"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="{StaticResource SpacingS}"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="{StaticResource SpacingS}"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="{StaticResource SpacingS}"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="{StaticResource SpacingS}"/>
          <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0"
                   Text="{DynamicResource Section.Publishing}"
                   Style="{StaticResource SectionHeader}"
                   Margin="0,0,0,8"/>

        <!-- Plattform -->
        <GroupBox Grid.Row="2"
                  Header="{DynamicResource Upload.Fields.Platform}">
          <Grid>
            <WrapPanel>
              <!-- YouTube Button -->
              <ToggleButton x:Name="PlatformYouTubeToggle"
                            IsChecked="True"
                            Style="{StaticResource PlatformToggleButton}"
                            Checked="PlatformYouTubeToggle_Checked"
                            Unchecked="PlatformYouTubeToggle_Unchecked">
                <StackPanel VerticalAlignment="Center"
                            HorizontalAlignment="Center">
                  <TextBlock Style="{StaticResource IconXXL}"
                             Text="&#xe038;"
                             Margin="0,0,24,0"/>
                  <TextBlock Text="{DynamicResource Upload.Fields.Platform.YouTube}"
                             FontSize="{StaticResource FontSizeS}"
                             Foreground="{StaticResource TextSecondaryBrush}"
                             HorizontalAlignment="Center"/>
                </StackPanel>
              </ToggleButton>

              <!-- TikTok Button (deaktiviert) -->
              <ToggleButton IsEnabled="False"
                            Style="{StaticResource PlatformToggleButton}"
                            ToolTip="Bald verfuegbar">
                <StackPanel VerticalAlignment="Center"
                            HorizontalAlignment="Center">
                  <Border Width="36"
                          Height="26"
                          CornerRadius="{StaticResource RadiusM}"
                          Background="Black"
                          Margin="0,0,0,8">
                    <TextBlock Text=""
                               Foreground="White"
                               FontSize="{StaticResource FontSizeM}"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                  </Border>
                  <TextBlock Text="{DynamicResource Upload.Fields.Platform.TikTok}"
                             FontSize="{StaticResource FontSizeS}"
                             Foreground="{StaticResource TextMutedBrush}"
                             HorizontalAlignment="Center"/>
                </StackPanel>
              </ToggleButton>
            </WrapPanel>
          </Grid>
        </GroupBox>

        <!-- Thumbnail -->
        <GroupBox Grid.Row="4"
                  Header="{DynamicResource Upload.Fields.Thumbnail}">
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="{StaticResource SpacingM}"/>
              <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Thumbnail Vorschau / Drop Zone -->
            <Viewbox Stretch="Uniform"
                     HorizontalAlignment="Left"
                     StretchDirection="Both">
              <Border x:Name="ThumbnailDropZone"
                      Grid.Row="0"
                      Width="320"
                      Height="180"
                      Style="{StaticResource ThumbnailDropZoneStyle}"
                      DragOver="ThumbnailDrop_DragOver"
                      DragLeave="ThumbnailDrop_DragLeave"
                      Drop="ThumbnailDrop_Drop"
                      MouseLeftButtonDown="ThumbnailDropZone_Click">

                <Grid>
                  <!-- Leerer Zustand -->
                  <Grid x:Name="ThumbnailEmptyState"
                        Visibility="Visible">
                    <StackPanel HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                      <TextBlock Style="{StaticResource IconXXL}"
                                 Text="&#xe40b;"
                                 HorizontalAlignment="Center"
                                 Margin="0,0,0,8"/>
                      <TextBlock Text="{DynamicResource Upload.Fields.Thumbnail.DropZone}"
                                 FontSize="{StaticResource FontSizeM}"
                                 Foreground="{StaticResource TextSecondaryBrush}"
                                 HorizontalAlignment="Center"/>
                      <TextBlock Text="{DynamicResource Upload.Fields.Thumbnail.DropZone.Descr}"
                                 FontSize="{StaticResource FontSizeS}"
                                 Foreground="{StaticResource TextMutedBrush}"
                                 HorizontalAlignment="Center"
                                 Margin="0,2,0,0"/>
                      <TextBlock Text="{DynamicResource Upload.Fields.Thumbnail.DropZone.AllowedFiles}"
                                 FontSize="{StaticResource FontSizeXS}"
                                 Foreground="{StaticResource TextMutedBrush}"
                                 HorizontalAlignment="Center"
                                 Margin="0,8,0,0"/>
                    </StackPanel>
                  </Grid>

                  <!-- Vorschau Zustand -->
                  <Grid x:Name="ThumbnailPreviewState"
                        Visibility="Collapsed">
                    <Image x:Name="ThumbnailPreviewImage"
                           Stretch="Uniform"/>
                    <Border x:Name="ThumbnailOverlay"
                            Background="{StaticResource OverlayDimBrush}"
                            Opacity="0">
                      <StackPanel HorizontalAlignment="Center"
                                  VerticalAlignment="Center">
                        <TextBlock Text="{DynamicResource Upload.Fields.Thumbnail.Change}"
                                   Foreground="White"
                                   FontSize="{StaticResource FontSizeM}"
                                   HorizontalAlignment="Center"/>
                      </StackPanel>
                    </Border>
                  </Grid>
                </Grid>
              </Border>
            </Viewbox>

            <!-- Thumbnail Aktionen -->
            <StackPanel Grid.Row="2"
                        Orientation="Horizontal"
                        Visibility="{Binding Visibility, ElementName=ThumbnailPreviewState}">
              <TextBlock x:Name="ThumbnailFileNameTextBlock"
                         Text="thumbnail.png"
                         FontSize="{StaticResource FontSizeS}"
                         Foreground="{StaticResource TextMutedBrush}"
                         VerticalAlignment="Center"
                         Margin="{StaticResource SpacingHorizontalM}"
                         MaxWidth="200"
                         TextTrimming="CharacterEllipsis"/>
              <Button x:Name="ThumbnailClearButton"
                      Content="{DynamicResource Common.Remove}"
                      Style="{StaticResource SecondaryButton}"
                      Click="ThumbnailClearButton_Click"
                      Padding="8,8"
                      FontSize="{StaticResource FontSizeS}"/>
            </StackPanel>

            <TextBox x:Name="ThumbnailPathTextBox"
                     Visibility="Collapsed"/>
          </Grid>
        </GroupBox>

        <!-- Sichtbarkeit -->
        <GroupBox Grid.Row="6"
                  Header="{DynamicResource Upload.Fields.Visibility}">
          <Grid>
            <ComboBox x:Name="VisibilityComboBox"
                      SelectionChanged="VisibilityComboBox_SelectionChanged">
              <ComboBoxItem Content="{DynamicResource Upload.Fields.Visibility.Public}"
                            Tag="{x:Static core:VideoVisibility.Public}"/>
              <ComboBoxItem Content="{DynamicResource Upload.Fields.Visibility.Unlisted}"
                            Tag="{x:Static core:VideoVisibility.Unlisted}"
                            IsSelected="True"/>
              <ComboBoxItem Content="{DynamicResource Upload.Fields.Visibility.Private}"
                            Tag="{x:Static core:VideoVisibility.Private}"/>
            </ComboBox>
          </Grid>
        </GroupBox>

        <!-- Playlist -->
        <GroupBox Grid.Row="8"
                  Header="{DynamicResource Upload.Fields.Paylists}">
          <Grid>
            <ComboBox x:Name="PlaylistComboBox"
                      DisplayMemberPath="Title"
                      ToolTip="Playlist, in die das Video einsortiert wird"
                      SelectionChanged="PlaylistComboBox_SelectionChanged"/>
          </Grid>
        </GroupBox>

        <!-- Ver”ffentlichung -->
        <GroupBox Grid.Row="10"
                  Header="{DynamicResource Upload.Fields.Publication}">
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="{StaticResource SpacingS}"/>
              <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <CheckBox x:Name="ScheduleCheckBox"
                      Grid.Row="0"
                      Content="{DynamicResource Upload.Fields.Publication.Plan}"
                      Checked="ScheduleCheckBox_Checked"
                      Unchecked="ScheduleCheckBox_Unchecked"
                      IsChecked="True"/>
            <Grid Grid.Row="2"
                  IsEnabled="{Binding IsChecked, ElementName=ScheduleCheckBox}">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="{StaticResource SpacingM}"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="{StaticResource SpacingL}"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="{StaticResource SpacingM}"/>
                <ColumnDefinition Width="80"/>
              </Grid.ColumnDefinitions>
              <TextBlock Grid.Column="0"
                         Text="{DynamicResource Upload.Fields.Publication.Date}"
                         VerticalAlignment="Center"
                         Foreground="{StaticResource TextSecondaryBrush}"/>
              <DatePicker x:Name="ScheduleDatePicker"
                          Grid.Column="2"
                          SelectedDateFormat="Short"
                          SelectedDateChanged="ScheduleDatePicker_SelectedDateChanged"
                          FirstDayOfWeek="Monday"/>
              <TextBlock Grid.Column="4"
                         Text="{DynamicResource Upload.Fields.Publication.Time}"
                         VerticalAlignment="Center"
                         Foreground="{StaticResource TextSecondaryBrush}"/>
              <TextBox x:Name="ScheduleTimeTextBox"
                       Grid.Column="6"
                       Text="18:00"
                       TextChanged="ScheduleTimeTextBox_TextChanged"/>
            </Grid>
          </Grid>
        </GroupBox>
      </Grid>

    </Grid>

    <!-- Vorschlags-Popup -->
    <Grid x:Name="SuggestionOverlay"
          Grid.Row="0"
          Grid.RowSpan="4"
          Background="{StaticResource OverlayMediumBrush}"
          Visibility="Collapsed"
          Panel.ZIndex="10">

      <Grid VerticalAlignment="Stretch"
            HorizontalAlignment="Center">
        <Border x:Name="SuggestionDialog"
                Style="{StaticResource SurfaceCard}"
                CornerRadius="{StaticResource RadiusL}"
                Padding="0"
                Width="{Binding ElementName=LeftColumnPanel, Path=ActualWidth}"
                MaxHeight="{Binding ElementName=LeftColumnPanel, Path=ActualHeight}"
                MinWidth="360"
                MaxWidth="780"
                VerticalAlignment="Top"
                Margin="0,120,0,0">
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="2"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0"
                    Background="{StaticResource MagicAIGradientBrush}"
                    CornerRadius="{StaticResource RadiusM}"/>

            <StackPanel Grid.Row="1"
                        Margin="{StaticResource SpacingAllM}">
              <DockPanel LastChildFill="False"
                         Margin="0,0,0,8">
                <TextBlock x:Name="SuggestionTitleTextBlock"
                           DockPanel.Dock="Left"
                           FontSize="{StaticResource FontSizeL}"
                           FontWeight="SemiBold"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           VerticalAlignment="Center"/>
                <Button x:Name="SuggestionCloseButton"
                        DockPanel.Dock="Right"
                        Style="{StaticResource SuggestionCloseButtonStyle}"
                        Click="SuggestionCloseButton_Click">
                  <TextBlock Style="{StaticResource IconL}"
                             Text="&#xe5cd;"
                             Margin="0"
                             Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"/>
                </Button>
              </DockPanel>

              <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl x:Name="SuggestionItemsControl">
                  <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                      <StackPanel/>
                    </ItemsPanelTemplate>
                  </ItemsControl.ItemsPanel>
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Button Style="{StaticResource SuggestionItemButtonStyle}"
                              Margin="0,0,0,8"
                              Click="SuggestionItemButton_Click"
                              HorizontalAlignment="Stretch">
                        <TextBlock Text="{Binding}"
                                   TextWrapping="Wrap"
                                   TextTrimming="CharacterEllipsis"/>
                      </Button>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </ScrollViewer>
            </StackPanel>
          </Grid>
        </Border>
      </Grid>
    </Grid>
  </Grid>
</UserControl>






